<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>End of World Prototype</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; margin: auto; background: #87CEEB; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

let gameRunning = true;
let score = 0;
let wave = 1;
let player = {x: 100, y: 300, w: 30, h: 50, vy: 0, onGround: true, color: "orange"};
let gravity = 0.8;
let enemies = [];
let powerups = [];
let cutscene = false;
let cutsceneTimer = 0;

// --- Input ---
let keys = {};
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

// --- Enemy spawn ---
function spawnEnemy() {
  let type = Math.random();
  if (type < 0.4) {
    enemies.push({x: canvas.width, y: 340, w: 30, h: 30, color: "red"}); // small enemy
  } else if (type < 0.7) {
    enemies.push({x: canvas.width, y: 300, w: 30, h: 70, color: "purple"}); // tall enemy
  } else {
    enemies.push({x: canvas.width, y: 360, w: 60, h: 20, color: "darkgreen"}); // tentacle
  }
}

// --- Powerups ---
function spawnPowerup() {
  let icons = ["blue", "yellow", "white", "cyan"];
  let c = icons[Math.floor(Math.random() * icons.length)];
  powerups.push({x: canvas.width, y: 200, w: 20, h: 20, color: c});
}

// --- Update ---
function update() {
  if (!gameRunning && !cutscene) return;

  if (!cutscene) {
    score++;

    // jump
    if (keys["Space"] && player.onGround) {
      player.vy = -14;
      player.onGround = false;
    }

    // gravity
    player.y += player.vy;
    player.vy += gravity;
    if (player.y + player.h >= 350) {
      player.y = 350 - player.h;
      player.vy = 0;
      player.onGround = true;
    }

    // move enemies
    enemies.forEach(e => e.x -= 5);
    enemies = enemies.filter(e => e.x + e.w > 0);

    // move powerups
    powerups.forEach(p => p.x -= 4);
    powerups = powerups.filter(p => p.x + p.w > 0);

    // collisions
    enemies.forEach(e => {
      if (player.x < e.x + e.w && player.x + player.w > e.x && player.y < e.y + e.h && player.y + player.h > e.y) {
        gameRunning = false; // hit
      }
    });

    powerups.forEach((p, i) => {
      if (player.x < p.x + p.w && player.x + player.w > p.x && player.y < p.y + p.h && player.y + player.h > p.y) {
        score += 100;
        powerups.splice(i, 1);
      }
    });

    // spawn waves
    if (score % 200 === 0) spawnEnemy();
    if (score % 500 === 0) spawnPowerup();

    if (score >= 2000) {
      cutscene = true;
      cutsceneTimer = 0;
    }
  } else {
    // simple cutscene
    cutsceneTimer++;
  }
}

// --- Draw ---
function draw() {
  if (!cutscene) {
    ctx.fillStyle = "#87CEEB";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ground
    ctx.fillStyle = "#444";
    ctx.fillRect(0, 350, canvas.width, 50);

    // player
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // enemies
    enemies.forEach(e => {
      ctx.fillStyle = e.color;
      ctx.fillRect(e.x, e.y, e.w, e.h);
    });

    // powerups
    powerups.forEach(p => {
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x + p.w/2, p.y + p.h/2, 10, 0, Math.PI*2);
      ctx.fill();
    });

    // HUD
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("Score: " + score, 10, 20);
    ctx.fillText("Wave: " + wave, 10, 40);

  } else {
    // cutscene screen
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (cutsceneTimer < 100) {
      ctx.fillStyle = "red";
      ctx.font = "40px Arial";
      ctx.fillText("The Sky Turns Red...", 200, 200);
    } else if (cutsceneTimer < 200) {
      ctx.fillStyle = "purple";
      ctx.fillText("Tentacles Rise...", 250, 200);
      ctx.fillRect(200, 250, 30, -cutsceneTimer/2); // tentacle
      ctx.fillRect(500, 250, 30, -cutsceneTimer/3); // tentacle
    } else {
      ctx.fillStyle = "white";
      ctx.font = "50px Arial";
      ctx.fillText("The End... for now", 220, 200);
    }
  }
}

// --- Game Loop ---
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
