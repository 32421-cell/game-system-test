<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>End of World Game Prototype</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; margin: auto; background: #87CEEB; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 800;
canvas.height = 400;

// --- Game States ---
let state = "menu"; // menu | game | gameover | cutscene
let score = 0;
let wave = 1;
let player, enemies, powerups;
let gravity = 0.8;

// --- Entities ---
function resetGame() {
  score = 0;
  wave = 1;
  player = {x: 100, y: 300, w: 30, h: 50, vy: 0, onGround: true, color: "orange"};
  enemies = [];
  powerups = [];
}

resetGame();

// --- Input ---
let keys = {};
document.addEventListener("keydown", e => {
  keys[e.code] = true;
  if (state === "menu" && e.code === "Enter") {
    state = "game";
    resetGame();
  }
  if (state === "gameover" && e.code === "Enter") {
    state = "menu";
  }
});
document.addEventListener("keyup", e => keys[e.code] = false);

// --- Enemy & Powerups ---
function spawnEnemy() {
  enemies.push({x: canvas.width, y: 320, w: 30, h: 30, color: "red"});
}
function spawnPowerup() {
  powerups.push({x: canvas.width, y: 200, w: 20, h: 20, color: "yellow"});
}

// --- Update ---
let cutsceneTimer = 0;

function update() {
  if (state === "game") {
    score++;

    // Jump
    if (keys["Space"] && player.onGround) {
      player.vy = -14;
      player.onGround = false;
    }

    // Gravity
    player.y += player.vy;
    player.vy += gravity;
    if (player.y + player.h >= 350) {
      player.y = 350 - player.h;
      player.vy = 0;
      player.onGround = true;
    }

    // Enemies
    enemies.forEach(e => e.x -= 5);
    enemies = enemies.filter(e => e.x + e.w > 0);

    // Powerups
    powerups.forEach(p => p.x -= 4);
    powerups = powerups.filter(p => p.x + p.w > 0);

    // Collisions
    enemies.forEach(e => {
      if (player.x < e.x + e.w && player.x + player.w > e.x && player.y < e.y + e.h && player.y + player.h > e.y) {
        state = "gameover";
      }
    });

    powerups.forEach((p, i) => {
      if (player.x < p.x + p.w && player.x + player.w > p.x && player.y < p.y + p.h && player.y + player.h > p.y) {
        score += 200;
        powerups.splice(i, 1);
      }
    });

    // Spawning logic
    if (score % 120 === 0) spawnEnemy();
    if (score % 400 === 0) spawnPowerup();

    if (score >= 2000) {
      state = "cutscene";
      cutsceneTimer = 0;
    }
  }

  if (state === "cutscene") {
    cutsceneTimer++;
  }
}

// --- Draw ---
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  if (state === "menu") {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "40px Arial";
    ctx.fillText("END OF WORLD", 250, 150);
    ctx.font = "20px Arial";
    ctx.fillText("Press ENTER to Start", 310, 220);
    ctx.fillText("Customize (coming soon)", 290, 260);
    ctx.fillText("Press SPACE to jump in-game", 270, 300);
  }

  if (state === "game") {
    // Background
    ctx.fillStyle = "#87CEEB";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "#444";
    ctx.fillRect(0, 350, canvas.width, 50);

    // Player
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.w, player.h);

    // Enemies
    enemies.forEach(e => {
      ctx.fillStyle = e.color;
      ctx.fillRect(e.x, e.y, e.w, e.h);
    });

    // Powerups
    powerups.forEach(p => {
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x + p.w/2, p.y + p.h/2, 10, 0, Math.PI*2);
      ctx.fill();
    });

    // HUD
    ctx.fillStyle = "black";
    ctx.font = "20px Arial";
    ctx.fillText("Score: " + score, 10, 20);
    ctx.fillText("Wave: " + wave, 10, 40);
  }

  if (state === "gameover") {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "red";
    ctx.font = "40px Arial";
    ctx.fillText("GAME OVER", 270, 180);
    ctx.font = "20px Arial";
    ctx.fillStyle = "white";
    ctx.fillText("Final Score: " + score, 320, 230);
    ctx.fillText("Press ENTER to return to menu", 250, 280);
  }

  if (state === "cutscene") {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    if (cutsceneTimer < 100) {
      ctx.fillStyle = "red";
      ctx.font = "40px Arial";
      ctx.fillText("The Sky Turns Red...", 200, 200);
    } else if (cutsceneTimer < 200) {
      ctx.fillStyle = "purple";
      ctx.fillText("Tentacles Rise...", 250, 200);
      ctx.fillRect(200, 250, 30, -cutsceneTimer/2);
      ctx.fillRect(500, 250, 30, -cutsceneTimer/3);
    } else {
      ctx.fillStyle = "white";
      ctx.font = "50px Arial";
      ctx.fillText("The End... for now", 220, 200);
      ctx.font = "20px Arial";
      ctx.fillText("Press ENTER to return to menu", 270, 260);
    }
  }
}

// --- Game Loop ---
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
