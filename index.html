<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Epic Shadow Runner</title>
<style>
body{margin:0;overflow:hidden;font-family:Arial;background:black;}
canvas{display:block;margin:auto;background:#87CEEB;}
#menu{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.85);color:white;
  display:flex;flex-direction:column;align-items:center;justify-content:center;
}
button{margin:10px;padding:10px 20px;font-size:20px;cursor:pointer;}
</style>
</head>
<body>
<div id="menu">
<h1>üèÉ Shadow Runner Epic üèÉ</h1>
<button id="startBtn">Start Game</button>
<p>SPACE = Jump / Double Jump | D = Dash | P = Pause</p>
</div>
<canvas id="gameCanvas" width="800" height="400"></canvas>
<script>
const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");

// --- Game States ---
let gameState="menu"; // menu | running | pause | gameover | cutscene

// --- Player ---
let player={
  x:100,y:300,w:40,h:60,vy:0,jumpCount:0,grounded:true,
  color:"orange",dashCooldown:0,dashActive:false,lives:3,scoreMultiplier:1
};
const gravity=0.8,jumpForce=-15;

// --- Background ---
let bgLayers=[
  {x:0,y:0,w:1600,h:400,speed:0.2,color:"#555"},
  {x:0,y:100,w:1600,h:200,speed:0.5,color:"#777"},
  {x:0,y:200,w:1600,h:150,speed:1,color:"#999"}
];

// --- Input ---
let keys={};
document.addEventListener("keydown",e=>{
  keys[e.code]=true;
  if(e.code==="Space"&&gameState==="menu") startGame();
  if(e.code==="KeyP" && gameState==="running") gameState="pause";
  else if(e.code==="KeyP" && gameState==="pause") gameState="running";
});
document.addEventListener("keyup",e=>keys[e.code]=false);

// --- Menu ---
const menuDiv=document.getElementById("menu");
document.getElementById("startBtn").onclick=startGame;

// --- Game Variables ---
let score=0,coins=0,wave=1,enemies=[],powerups=[],bosses=[];
let cutsceneTimer=0;

// --- Reset Game ---
function resetGame(){
  player.y=300;player.vy=0;player.jumpCount=0;player.grounded=true;player.dashActive=false;player.dashCooldown=0;
  player.lives=3;player.scoreMultiplier=1;
  score=0;coins=0;wave=1;
  enemies=[];powerups=[];bosses=[];
  cutsceneTimer=0;
}

// --- Spawn Functions ---
function spawnEnemy(type){
  let y=300,w=30,h=30,color="red";
  if(type==="tall"){y=270;h=60;color="purple";}
  if(type==="tentacle"){y=330;h=20;w=60;color="green";}
  enemies.push({x:canvas.width+50,y:y,w:w,h:h,color:color,vx:4+wave*0.2});
}

function spawnPowerup(){
  let colors=["yellow","blue","cyan","white"];
  let color=colors[Math.floor(Math.random()*colors.length)];
  powerups.push({x:canvas.width+50,y:200+Math.random()*100,w:20,h:20,color:color});
}

function spawnBoss(){
  bosses.push({x:canvas.width+50,y:250,w:80,h:80,hp:200+wave*20,color:"purple",vx:1.5,attackTimer:0});
}

// --- Update ---
function update(){
  if(gameState!=="running") return;

  // Player jump
  if(keys["Space"] && (player.grounded || player.jumpCount<2)){
    player.vy=jumpForce;player.grounded=false;player.jumpCount++;
  }

  // Dash
  if(keys["KeyD"] && player.dashCooldown<=0){player.dashActive=true;player.dashCooldown=120;}
  if(player.dashActive){player.x+=6;player.dashActive=false;}
  if(player.dashCooldown>0) player.dashCooldown--;

  // Gravity
  player.vy+=gravity; player.y+=player.vy;
  if(player.y+player.h>=350){player.y=350-player.h;player.vy=0;player.grounded=true;player.jumpCount=0;}

  // Background
  bgLayers.forEach(l=>{l.x-=l.speed*2;if(l.x<=-l.w/2)l.x=0;});

  // Update enemies
  enemies.forEach((e,i)=>{
    e.x-=e.vx;
    if(player.x<e.x+e.w && player.x+player.w>e.x && player.y<e.y+e.h && player.y+player.h>e.y){
      player.lives--; if(player.lives<=0) gameState="gameover"; enemies.splice(i,1);
    }
    if(e.x+e.w<0) enemies.splice(i,1);
  });

  // Powerups
  powerups.forEach((p,i)=>{
    p.x-=4;
    if(player.x<p.x+p.w && player.x+player.w>p.x && player.y<p.y+p.h && player.y+player.h>p.y){coins+=10;powerups.splice(i,1);}
    if(p.x+p.w<0) powerups.splice(i,1);
  });

  // Bosses
  bosses.forEach((b,i)=>{
    b.x-=b.vx; b.attackTimer++;
    if(b.attackTimer%120===0) enemies.push({x:b.x,y:b.y+40,w:15,h:15,color:"pink",vx:6});
    if(player.x<b.x+b.w && player.x+player.w>b.x && player.y<b.y+b.h && player.y+player.h>b.y){player.lives--; if(player.lives<=0) gameState="gameover";}
    if(b.hp<=0){ bosses.splice(i,1); coins+=50; gameState="cutscene"; cutsceneTimer=0;}
  });

  // Wave system
  if(score%150===0){let rand=Math.random();if(rand<0.4) spawnEnemy("small"); else if(rand<0.7) spawnEnemy("tall"); else spawnEnemy("tentacle");}
  if(score%600===0) spawnPowerup();
  if(score>wave*1000){ wave++; if(wave%5===0) spawnBoss(); }

  // Score increment
  score++;
}

// --- Draw ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Background
  ctx.fillStyle="#87CEEB"; ctx.fillRect(0,0,canvas.width,canvas.height);
  bgLayers.forEach(l=>{ctx.fillStyle=l.color; ctx.fillRect(l.x,l.y,l.w,l.h); ctx.fillRect(l.x+l.w,l.y,l.w,l.h);});

  // Ground
  ctx.fillStyle="#444"; ctx.fillRect(0,350,canvas.width,50);

  // Player
  ctx.fillStyle=player.color; ctx.fillRect(player.x,player.y,player.w,player.h);

  // Enemies
  enemies.forEach(e=>{ctx.fillStyle=e.color; ctx.fillRect(e.x,e.y,e.w,e.h);});

  // Powerups
  powerups.forEach(p=>{ctx.fillStyle=p.color;ctx.beginPath();ctx.arc(p.x+p.w/2,p.y+p.h/2,10,0,Math.PI*2);ctx.fill();});

  // Bosses
  bosses.forEach(b=>{ctx.fillStyle=b.color;ctx.fillRect(b.x,b.y,b.w,b.h);ctx.fillStyle="white";ctx.font="16px Arial";ctx.fillText("HP:"+b.hp,b.x,b.y-5);});

  // HUD
  ctx.fillStyle="white"; ctx.font="20px Arial";
  ctx.fillText("Score: "+score,10,20); ctx.fillText("Coins: "+coins,10,40); ctx.fillText("Wave: "+wave,10,60); ctx.fillText("Lives: "+player.lives,10,80);
}

// --- Cutscene ---
function drawCutscene(){
  cutsceneTimer++;
  let skyShade=Math.min(0.85,cutsceneTimer/200);
  ctx.fillStyle=`rgba(20,0,30,${skyShade})`; ctx.fillRect(0,0,canvas.width,canvas.height);

  let shake=Math.min(10,cutsceneTimer/15); let offsetX=Math.random()*shake-shake/2; let offsetY=Math.random()*shake-shake/2;
  ctx.save(); ctx.translate(offsetX,offsetY);

  // Tentacles
  ctx.fillStyle="darkgreen"; for(let i=0;i<5;i++){let height=Math.min(200,cutsceneTimer*2-i*30); if(height>0) ctx.fillRect(150+i*120,350-height,30,height);}

  // Explosions
  if(cutsceneTimer%30<15){ctx.fillStyle="orange"; ctx.beginPath(); ctx.arc(400+Math.sin(cutsceneTimer/5)*50,300+Math.cos(cutsceneTimer/7)*30,30,0,Math.PI*2); ctx.fill();}

  // Text overlay
  ctx.fillStyle="white"; ctx.font="40px Arial";
  if(cutsceneTimer<120) ctx.fillText("The World Trembles...",180,100);
  else if(cutsceneTimer<240) ctx.fillText("Monsters Rise From Shadows",100,100);
  else if(cutsceneTimer<360) ctx.fillText("Humanity Fights For Survival",80,100);
  else{ctx.fillText("The End... For Now",200,100); ctx.font="20px Arial"; ctx.fillText("Press ENTER to return to menu",250,150);
  if(keys["Enter"]){gameState="menu"; menuDiv.style.display="flex"; resetGame();}}
  ctx.restore();
}

// --- Game Loop ---
function loop(){
  if(gameState==="running") update(),draw();
  else if(gameState==="cutscene") drawCutscene();
  else if(gameState==="pause"){ctx.fillStyle="rgba(0,0,0,0.5)";ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle="white";ctx.font="40px Arial";ctx.fillText("PAUSED",320,200);}
  else if(gameState==="gameover"){ctx.fillStyle="black";ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle="red";ctx.font="40px Arial"; ctx.fillText("GAME OVER",270,180); ctx.fillStyle="white"; ctx.font="20px Arial"; ctx.fillText("Final Score: "+score,320,230); ctx.fillText("Coins Collected: "+coins,300,260); ctx.fillText("Press ENTER to return to menu",250,290); if(keys["Enter"]){gameState="menu"; menuDiv.style.display="flex"; resetGame();}}
  requestAnimationFrame(loop);
}

// --- Start Game ---
function startGame(){resetGame(); gameState="running"; menuDiv.style.display="none";}

loop();
</script>
</body>
</html>
